%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%                                                                              %
% SU2 configuration file                                                       %
% Case description: flow through a heat exchanger, CHT setup                   %
% Author: Nijso Beishuizen, Ole Burghardt, Evert Bunschoten                    %
% Institution: Bosch Thermotechniek BV, Technical University of Kaiserslautern %
% Date: 24/11/2020                                                             %
%                                                                              %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

SOLVER= MULTIPHYSICS

CONFIG_LIST= ( fluid.cfg, solid_burner.cfg,solid_hex.cfg)

OBJECTIVE_FUNCTION= CUSTOM_OBJFUNC
MARKER_MONITORING= ( cht_burner_fluid_solid, cht_burner_solid_fluid,\
                         cht_hex_fluid_solid, cht_hex_solid_fluid)

%%%%%%%%%%%%%%%%%%
%   Mesh stuff   %
%%%%%%%%%%%%%%%%%%

MESH_FORMAT= SU2
MULTIZONE_MESH=NO

% define the interface between the zones
MARKER_ZONE_INTERFACE= ( cht_burner_fluid_solid, cht_burner_solid_fluid,\
                         cht_hex_fluid_solid, cht_hex_solid_fluid)
MARKER_CHT_INTERFACE=  ( cht_burner_fluid_solid, cht_burner_solid_fluid,\
                         cht_hex_fluid_solid, cht_hex_solid_fluid)

CHT_COUPLING_METHOD= DIRECT_TEMPERATURE_ROBIN_HEATFLUX

RESTART_SOL=YES

GRAD_OBJFUNC_FILENAME= of_grad.csv

TIME_DOMAIN= NO
OUTER_ITER=20000

OUTPUT_WRT_FREQ= 1000
SCREEN_WRT_FREQ_INNER= 1
SCREEN_WRT_FREQ_OUTER= 1

WRT_VOLUME_OVERWRITE= YES

WRT_ZONE_CONV= YES
CONV_STARTITER= 1
MESH_OUT_FILENAME=mesh_ffd_box.su2
%__DIRECT__CONV_FIELD = RMS_PRESSURE[0], RMS_VELOCITY-X[0], RMS_VELOCITY-Y[0], RMS_MixtureFraction[0], RMS_EnthalpyTot[0], RMS_ProgressVariable[0], RMS_TEMPERATURE[1]


%__ADJOINT__CONV_FIELD= RMS_ADJ_PRESSURE[0], RMS_ADJ_VELOCITY-X[0], RMS_ADJ_VELOCITY-Y[0], RMS_ADJ_MixtureFraction[0], RMS_ADJ_EnthalpyTot[0], RMS_ADJ_ProgressVariable[0], RMS_ADJ_TEMPERATURE[1]
%__DIRECT__CONV_RESIDUAL_MINVAL= -12.5
%__ADJOINT__CONV_RESIDUAL_MINVAL=-13.76


% --------------------------- Optimization Parameters --------------------------%

OUTPUT_FILES=(RESTART)

% -------------------- FREE-FORM DEFORMATION PARAMETERS -----------------------%
%
% Tolerance of the Free-Form Deformation point inversion
FFD_TOLERANCE= 1E-10
%
% Maximum number of iterations in the Free-Form Deformation point inversion
FFD_ITERATIONS= 1000
%
% FFD box definition: 3D case (FFD_BoxTag, X1, Y1, Z1, X2, Y2, Z2, X3, Y3, Z3, X4, Y4, Z4,
%                              X5, Y5, Z5, X6, Y6, Z6, X7, Y7, Z7, X8, Y8, Z8)
%                     2D case (FFD_BoxTag, X1, Y1, 0.0, X2, Y2, 0.0, X3, Y3, 0.0, X4, Y4, 0.0,
%                              0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0)
% Start at the lowest leftest corner and turn counter-clockwise
DV_MARKER= ( cht_burner_fluid_solid, cht_burner_solid_fluid;\
             cht_hex_fluid_solid, cht_hex_solid_fluid )

% Start at the lowest leftest corner and turn counter-clockwise
FFD_DEFINITION= (BOX_BURNER,\
0.00225, 0.0, 0.0,\
0.00375, 0.0, 0.0,\
0.00375, 0.0008, 0.0,\
0.00225, 0.0008, 0.0,\
0, 0, 0.0,\
0, 0, 0.0,\
0, 0, 0.0,\
0, 0, 0.0);(BOX_HEX, 0.00525, 0, 0.0,\
0.00675, 0, 0.0,\
0.00675, 0.0008, 0.0,\
0.00525, 0.0008, 0.0,\
0, 0, 0.0,\
0, 0, 0.0,\
0, 0, 0.0,\
0, 0, 0.0)

% %

%
% FFD box degree: 3D case (i_degree, j_degree, k_degree)
%                 2D case (i_degree, j_degree, 0)
FFD_DEGREE= (4, 4, 0;\
             4, 4, 0)
%

% ----------------------- DESIGN VARIABLE PARAMETERS --------------------------%
%
FFD_CONTINUITY= USER_INPUT

DV_KIND= FFD_SETTING

% %DV_KIND= FFD_SETTING
% Definition of design variable parameters
% DV_PARAM = (FFD_BOX_NAME, idx_x, idx_y, idx_z, i_x, i_y, i_z);
% FFD_BOX_NAME: name of the box in FFD_DEFINITION
% idx_x, idx_y, idx_z: control point indices. For 2D FFD, only give idx_x and idx_y 
% i_x, i_y, i_z: unit vector along which control point moves.
DV_PARAM= 0
            

DV_VALUE=0.0
% ------------------------ GRID DEFORMATION PARAMETERS ------------------------%
%
% Linear solver or smoother for implicit formulations (FGMRES, RESTARTED_FGMRES, BCGSTAB)
DEFORM_LINEAR_SOLVER= FGMRES
%
% Preconditioner of the Krylov linear solver (ILU, LU_SGS, JACOBI)
DEFORM_LINEAR_SOLVER_PREC= ILU
%
% Number of smoothing iterations for mesh deformation
DEFORM_LINEAR_SOLVER_ITER= 1000
%
% Number of nonlinear deformation iterations (surface deformation increments)
DEFORM_NONLINEAR_ITER= 1
%
% Minimum residual criteria for the linear solver convergence of grid deformation
DEFORM_LINEAR_SOLVER_ERROR= 1E-14
%
% Print the residuals during mesh deformation to the console (YES, NO)
DEFORM_CONSOLE_OUTPUT= YES
%
% Deformation coefficient (linear elasticity limits from -1.0 to 0.5, a larger
% value is also possible)
DEFORM_COEFF = 0.0
%
% Type of element stiffness imposed for FEA mesh deformation (INVERSE_VOLUME,
%                                           WALL_DISTANCE, CONSTANT_STIFFNESS)
DEFORM_STIFFNESS_TYPE= WALL_DISTANCE
%
% Deform the grid only close to the surface. It is possible to specify how much
% of the volumetric grid is going to be deformed in meters or inches (1E6 by default)
DEFORM_LIMIT = 1E6
